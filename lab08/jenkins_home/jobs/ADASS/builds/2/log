Started by user [8mha:////4ALD18H7akOtUgmSgrs5S/1VrdxEYk2hZEvY2lOBKdj0AAAAlh+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAzOEgYu/dLi1CL9vNKcHACFIKlWvwAAAA==[0manonymous
Building in workspace /var/jenkins_home/jobs/ADASS/workspace
[workspace] $ /bin/sh -xe /tmp/jenkins1434508543702641361.sh
+ export ANSIBLE_HOST_KEY_CHECKING=False
+ cd /var/jenkins_home/jobs/ADASS/workspace
+ ansible-playbook -i envs/development/hosts play.yml --tags=build,deploy -vvv
Using /etc/ansible/ansible.cfg as config file

PLAYBOOK: play.yml *************************************************************
1 plays in play.yml

PLAY [ADASS deployment] ********************************************************

TASK [build : Build applications images] ***************************************
task path: /var/jenkins_home/jobs/ADASS/workspace/roles/build/tasks/main.yml:1
Using module file /usr/lib/python2.7/dist-packages/ansible/modules/core/commands/command.py
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: root
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo ~/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817 `" && echo ansible-tmp-1508523713.92-249666799651817="` echo ~/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817 `" ) && sleep 0'
<localhost> PUT /tmp/tmpDRI2Pd TO /root/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817/command.py
<localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817/ /root/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817/command.py && sleep 0'
<localhost> EXEC /bin/sh -c 'RELEASE=1.0 STAGE=development /usr/bin/python /root/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817/command.py; rm -rf "/root/.ansible/tmp/ansible-tmp-1508523713.92-249666799651817/" > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true, 
    "cmd": [
        "docker-compose", 
        "build", 
        "--no-cache"
    ], 
    "delta": "0:00:43.009969", 
    "end": "2017-10-20 18:22:37.019480", 
    "invocation": {
        "module_args": {
            "_raw_params": "docker-compose build --no-cache", 
            "_uses_shell": false, 
            "chdir": "./docker", 
            "creates": null, 
            "executable": null, 
            "removes": null, 
            "warn": true
        }, 
        "module_name": "command"
    }, 
    "rc": 0, 
    "start": "2017-10-20 18:21:54.009511", 
    "stderr": "redis uses an image, skipping\nBuilding app\nnginx uses an image, skipping", 
    "stdout": "Step 1/9 : FROM python:3\n ---> 01fd71a97c19\nStep 2/9 : ARG STAGE=development\n ---> Running in 5d0bcd75920c\n ---> b70f50385076\nRemoving intermediate container 5d0bcd75920c\nStep 3/9 : ARG RELEASE=1.0\n ---> Running in cf56a48d9cb4\n ---> 72aa7513236b\nRemoving intermediate container cf56a48d9cb4\nStep 4/9 : WORKDIR /usr/src/app\n ---> 9891fd2cdc46\nRemoving intermediate container 76d0597030fa\nStep 5/9 : RUN pip install pyramid pyramid_jinja2 redis\n ---> Running in 05e602a75d68\nCollecting pyramid\n  Downloading pyramid-1.9.1-py2.py3-none-any.whl (582kB)\nCollecting pyramid_jinja2\n  Downloading pyramid_jinja2-2.7-py2.py3-none-any.whl (70kB)\nCollecting redis\n  Downloading redis-2.10.6-py2.py3-none-any.whl (64kB)\nCollecting PasteDeploy>=1.5.0 (from pyramid)\n  Downloading PasteDeploy-1.5.2-py2.py3-none-any.whl\nCollecting repoze.lru>=0.4 (from pyramid)\n  Downloading repoze.lru-0.7-py3-none-any.whl\nCollecting plaster-pastedeploy (from pyramid)\n  Downloading plaster_pastedeploy-0.4.1-py2.py3-none-any.whl\nCollecting hupper (from pyramid)\n  Downloading hupper-1.0-py2.py3-none-any.whl\nRequirement already satisfied: setuptools in /usr/local/lib/python3.6/site-packages (from pyramid)\nCollecting venusian>=1.0a3 (from pyramid)\n  Downloading venusian-1.1.0-py2.py3-none-any.whl\nCollecting WebOb>=1.7.0rc2 (from pyramid)\n  Downloading WebOb-1.7.3-py2.py3-none-any.whl (83kB)\nCollecting zope.deprecation>=3.5.0 (from pyramid)\n  Downloading zope.deprecation-4.3.0-py2.py3-none-any.whl\nCollecting translationstring>=0.4 (from pyramid)\n  Downloading translationstring-1.3-py2.py3-none-any.whl\nCollecting plaster (from pyramid)\n  Downloading plaster-1.0-py2.py3-none-any.whl\nCollecting zope.interface>=3.8.0 (from pyramid)\n  Downloading zope.interface-4.4.3-cp36-cp36m-manylinux1_x86_64.whl (173kB)\nCollecting Jinja2>=2.5.0 (from pyramid_jinja2)\n  Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)\nCollecting MarkupSafe (from pyramid_jinja2)\n  Downloading MarkupSafe-1.0.tar.gz\nBuilding wheels for collected packages: MarkupSafe\n  Running setup.py bdist_wheel for MarkupSafe: started\n  Running setup.py bdist_wheel for MarkupSafe: finished with status 'done'\n  Stored in directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57\nSuccessfully built MarkupSafe\nInstalling collected packages: PasteDeploy, repoze.lru, plaster, plaster-pastedeploy, hupper, venusian, WebOb, zope.deprecation, translationstring, zope.interface, pyramid, MarkupSafe, Jinja2, pyramid-jinja2, redis\nSuccessfully installed Jinja2-2.9.6 MarkupSafe-1.0 PasteDeploy-1.5.2 WebOb-1.7.3 hupper-1.0 plaster-1.0 plaster-pastedeploy-0.4.1 pyramid-1.9.1 pyramid-jinja2-2.7 redis-2.10.6 repoze.lru-0.7 translationstring-1.3 venusian-1.1.0 zope.deprecation-4.3.0 zope.interface-4.4.3\n ---> 934a1dfabe2e\nRemoving intermediate container 05e602a75d68\nStep 6/9 : COPY app /usr/src/app\n ---> e445ca695c41\nStep 7/9 : COPY puppy.jpg /var/puppy.jpg\n ---> e3cf51b94468\nStep 8/9 : EXPOSE 8080\n ---> Running in 92e8c2f05d56\n ---> d99f4b726f74\nRemoving intermediate container 92e8c2f05d56\nStep 9/9 : CMD python /usr/src/app/app.py\n ---> Running in 8ae3e663f81d\n ---> 92ee0f351bd7\nRemoving intermediate container 8ae3e663f81d\nSuccessfully built 92ee0f351bd7\nSuccessfully tagged aaguirre/app:jenk", 
    "stdout_lines": [
        "Step 1/9 : FROM python:3", 
        " ---> 01fd71a97c19", 
        "Step 2/9 : ARG STAGE=development", 
        " ---> Running in 5d0bcd75920c", 
        " ---> b70f50385076", 
        "Removing intermediate container 5d0bcd75920c", 
        "Step 3/9 : ARG RELEASE=1.0", 
        " ---> Running in cf56a48d9cb4", 
        " ---> 72aa7513236b", 
        "Removing intermediate container cf56a48d9cb4", 
        "Step 4/9 : WORKDIR /usr/src/app", 
        " ---> 9891fd2cdc46", 
        "Removing intermediate container 76d0597030fa", 
        "Step 5/9 : RUN pip install pyramid pyramid_jinja2 redis", 
        " ---> Running in 05e602a75d68", 
        "Collecting pyramid", 
        "  Downloading pyramid-1.9.1-py2.py3-none-any.whl (582kB)", 
        "Collecting pyramid_jinja2", 
        "  Downloading pyramid_jinja2-2.7-py2.py3-none-any.whl (70kB)", 
        "Collecting redis", 
        "  Downloading redis-2.10.6-py2.py3-none-any.whl (64kB)", 
        "Collecting PasteDeploy>=1.5.0 (from pyramid)", 
        "  Downloading PasteDeploy-1.5.2-py2.py3-none-any.whl", 
        "Collecting repoze.lru>=0.4 (from pyramid)", 
        "  Downloading repoze.lru-0.7-py3-none-any.whl", 
        "Collecting plaster-pastedeploy (from pyramid)", 
        "  Downloading plaster_pastedeploy-0.4.1-py2.py3-none-any.whl", 
        "Collecting hupper (from pyramid)", 
        "  Downloading hupper-1.0-py2.py3-none-any.whl", 
        "Requirement already satisfied: setuptools in /usr/local/lib/python3.6/site-packages (from pyramid)", 
        "Collecting venusian>=1.0a3 (from pyramid)", 
        "  Downloading venusian-1.1.0-py2.py3-none-any.whl", 
        "Collecting WebOb>=1.7.0rc2 (from pyramid)", 
        "  Downloading WebOb-1.7.3-py2.py3-none-any.whl (83kB)", 
        "Collecting zope.deprecation>=3.5.0 (from pyramid)", 
        "  Downloading zope.deprecation-4.3.0-py2.py3-none-any.whl", 
        "Collecting translationstring>=0.4 (from pyramid)", 
        "  Downloading translationstring-1.3-py2.py3-none-any.whl", 
        "Collecting plaster (from pyramid)", 
        "  Downloading plaster-1.0-py2.py3-none-any.whl", 
        "Collecting zope.interface>=3.8.0 (from pyramid)", 
        "  Downloading zope.interface-4.4.3-cp36-cp36m-manylinux1_x86_64.whl (173kB)", 
        "Collecting Jinja2>=2.5.0 (from pyramid_jinja2)", 
        "  Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)", 
        "Collecting MarkupSafe (from pyramid_jinja2)", 
        "  Downloading MarkupSafe-1.0.tar.gz", 
        "Building wheels for collected packages: MarkupSafe", 
        "  Running setup.py bdist_wheel for MarkupSafe: started", 
        "  Running setup.py bdist_wheel for MarkupSafe: finished with status 'done'", 
        "  Stored in directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57", 
        "Successfully built MarkupSafe", 
        "Installing collected packages: PasteDeploy, repoze.lru, plaster, plaster-pastedeploy, hupper, venusian, WebOb, zope.deprecation, translationstring, zope.interface, pyramid, MarkupSafe, Jinja2, pyramid-jinja2, redis", 
        "Successfully installed Jinja2-2.9.6 MarkupSafe-1.0 PasteDeploy-1.5.2 WebOb-1.7.3 hupper-1.0 plaster-1.0 plaster-pastedeploy-0.4.1 pyramid-1.9.1 pyramid-jinja2-2.7 redis-2.10.6 repoze.lru-0.7 translationstring-1.3 venusian-1.1.0 zope.deprecation-4.3.0 zope.interface-4.4.3", 
        " ---> 934a1dfabe2e", 
        "Removing intermediate container 05e602a75d68", 
        "Step 6/9 : COPY app /usr/src/app", 
        " ---> e445ca695c41", 
        "Step 7/9 : COPY puppy.jpg /var/puppy.jpg", 
        " ---> e3cf51b94468", 
        "Step 8/9 : EXPOSE 8080", 
        " ---> Running in 92e8c2f05d56", 
        " ---> d99f4b726f74", 
        "Removing intermediate container 92e8c2f05d56", 
        "Step 9/9 : CMD python /usr/src/app/app.py", 
        " ---> Running in 8ae3e663f81d", 
        " ---> 92ee0f351bd7", 
        "Removing intermediate container 8ae3e663f81d", 
        "Successfully built 92ee0f351bd7", 
        "Successfully tagged aaguirre/app:jenk"
    ], 
    "warnings": []
}

TASK [deploy : Reset environment] **********************************************
task path: /var/jenkins_home/jobs/ADASS/workspace/roles/deploy/tasks/main.yml:1
Using module file /usr/lib/python2.7/dist-packages/ansible/modules/core/commands/command.py
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: root
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo ~/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040 `" && echo ansible-tmp-1508523757.08-242284628786040="` echo ~/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040 `" ) && sleep 0'
<localhost> PUT /tmp/tmpMp_6t9 TO /root/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040/command.py
<localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040/ /root/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040/command.py && sleep 0'
<localhost> EXEC /bin/sh -c 'RELEASE=1.0 STAGE=development /usr/bin/python /root/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040/command.py; rm -rf "/root/.ansible/tmp/ansible-tmp-1508523757.08-242284628786040/" > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true, 
    "cmd": [
        "docker-compose", 
        "down"
    ], 
    "delta": "0:00:14.791109", 
    "end": "2017-10-20 18:22:51.966649", 
    "invocation": {
        "module_args": {
            "_raw_params": "docker-compose down", 
            "_uses_shell": false, 
            "chdir": "./docker", 
            "creates": null, 
            "executable": null, 
            "removes": null, 
            "warn": true
        }, 
        "module_name": "command"
    }, 
    "rc": 0, 
    "start": "2017-10-20 18:22:37.175540", 
    "stderr": "Stopping app   ... \r\nStopping redis ... \r\n\u001b[2A\u001b[2K\rStopping app   ... \u001b[32mdone\u001b[0m\r\u001b[2B\u001b[1A\u001b[2K\rStopping redis ... \u001b[32mdone\u001b[0m\r\u001b[1BRemoving nginx ... \r\nRemoving app   ... \r\nRemoving redis ... \r\n\u001b[2A\u001b[2K\rRemoving app   ... \u001b[32mdone\u001b[0m\r\u001b[2B\u001b[1A\u001b[2K\rRemoving redis ... \u001b[32mdone\u001b[0m\r\u001b[1B\u001b[3A\u001b[2K\rRemoving nginx ... \u001b[32mdone\u001b[0m\r\u001b[3BRemoving network docker_default", 
    "stdout": "", 
    "stdout_lines": [], 
    "warnings": []
}

TASK [deploy : Deploy containers] **********************************************
task path: /var/jenkins_home/jobs/ADASS/workspace/roles/deploy/tasks/main.yml:10
Using module file /usr/lib/python2.7/dist-packages/ansible/modules/core/commands/command.py
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: root
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo ~/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907 `" && echo ansible-tmp-1508523772.02-31536491248907="` echo ~/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907 `" ) && sleep 0'
<localhost> PUT /tmp/tmpzl6jX4 TO /root/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907/command.py
<localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907/ /root/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907/command.py && sleep 0'
<localhost> EXEC /bin/sh -c 'RELEASE=1.0 STAGE=development /usr/bin/python /root/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907/command.py; rm -rf "/root/.ansible/tmp/ansible-tmp-1508523772.02-31536491248907/" > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true, 
    "cmd": [
        "docker-compose", 
        "up", 
        "-d"
    ], 
    "delta": "0:00:03.427102", 
    "end": "2017-10-20 18:22:55.555376", 
    "invocation": {
        "module_args": {
            "_raw_params": "docker-compose up -d", 
            "_uses_shell": false, 
            "chdir": "./docker", 
            "creates": null, 
            "executable": null, 
            "removes": null, 
            "warn": true
        }, 
        "module_name": "command"
    }, 
    "rc": 0, 
    "start": "2017-10-20 18:22:52.128274", 
    "stderr": "Creating network \"docker_default\" with driver \"bridge\"\nCreating redis ... \r\nCreating redis\n\u001b[1A\u001b[2K\rCreating redis ... \u001b[32mdone\u001b[0m\r\u001b[1BCreating app ... \r\nCreating app\n\u001b[1A\u001b[2K\rCreating app ... \u001b[32mdone\u001b[0m\r\u001b[1BCreating nginx ... \r\nCreating nginx\n\u001b[1A\u001b[2K\rCreating nginx ... \u001b[32mdone\u001b[0m\r\u001b[1B", 
    "stdout": "", 
    "stdout_lines": [], 
    "warnings": []
}

PLAY RECAP *********************************************************************
localhost                  : ok=3    changed=3    unreachable=0    failed=0   

Finished: SUCCESS
